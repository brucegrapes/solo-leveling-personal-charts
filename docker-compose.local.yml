# Local Development Docker Configuration
# Uses different ports and separate MongoDB instance from production

services:
  mongodb-local:
    image: mongo:7.0
    container_name: solo-leveling-mongodb-local
    restart: unless-stopped
    ports:
      - "27018:27017"  # Map host 27018 to container 27017
    environment:
      MONGO_INITDB_DATABASE: solo-leveling-local
    volumes:
      - mongodb_local_data:/data/db
      - mongodb_local_config:/data/configdb
    networks:
      - solo-leveling-local-network
    healthcheck:
      test: echo 'db.runCommand("ping").ok' | mongosh localhost:27017/solo-leveling-local --quiet
      interval: 10s
      timeout: 5s
      retries: 5

  nextjs-local:
    build:
      context: .
      dockerfile: Dockerfile.local
      network: host
    container_name: solo-leveling-app-local-v2
    restart: unless-stopped
    ports:
      - "3001:3001"  # Map host 3001 to container 3001
    environment:
      - NODE_ENV=development
      - MONGODB_URI=mongodb://mongodb-local:27017/solo-leveling-local
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET:-dev-secret-key-change-in-production}
      - AUTH_TRUST_HOST=true
    depends_on:
      mongodb-local:
        condition: service_healthy
    networks:
      - solo-leveling-local-network
    volumes:
      # Mount source for hot reload in development
      - ./src:/app/src:ro
      - ./public:/app/public:ro

volumes:
  mongodb_local_data:
    driver: local
  mongodb_local_config:
    driver: local

networks:
  solo-leveling-local-network:
    driver: bridge
